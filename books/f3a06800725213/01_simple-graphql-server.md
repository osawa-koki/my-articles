---
title: "ç°¡å˜ãªGraphQLã‚µãƒ¼ãƒã‚’ä½œæˆã—ã¦ã¿ã‚ˆã†ï¼"
---

## ã¯ã˜ã‚ã«

ã“ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã§ã¯Node.jsã‚’ç”¨ã„ã¦æœ€ã‚‚ç°¡å˜ãªGraphQLã‚µãƒ¼ãƒã‚’å®Ÿè£…ã—ã¦ã¿ã¾ã™ã€‚  
ä»¥ä¸‹ã®ç’°å¢ƒãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’æƒ³å®šã—ã¾ã™ã€‚  

| name | version |
| --- | --- |
| Node.js | >= 18.x |
| yarn | >= 12.x.x |

## Node.jsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

ã¾ãšã¯ã€Node.jsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚  

```bash
# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆã¨ç§»å‹•ã€‚
mkdir <project-name> && cd <project-name>

# Node.jsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸåŒ–ã€‚ 
yarn init -y
```

ã“ã‚Œã§ã€`package.json`ãŒä½œæˆã•ã‚Œã¾ã™ã€‚  
å½“ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œã™ã‚‹ãŸã‚ã€`"type": "module"`ã‚’è¿½åŠ ã—ã¦ãŠãã¾ã™ã€‚  

```json
{
  ...
  "type": "module"
}
```

## å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

æ¬¡ã«GraphQLã‚µãƒ¼ãƒã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã«å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚  

```bash
yarn add @apollo/server graphql
```

`graphql`ã¯GraphQLã«é–¢ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã€`@apollo/server`ã¯GraphQLã‚µãƒ¼ãƒã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã™ã€‚  

---

ã¾ãŸã€ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«`nodemon`ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚  
ã“ã‚Œã§ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´ã‚’æ¤œçŸ¥ã—ã¦è‡ªå‹•çš„ã«ã‚µãƒ¼ãƒã‚’å†èµ·å‹•ã—ã¦ãã‚Œã¾ã™ã€‚  

```bash
yarn add -D nodemon
```

## yarnã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¨­å®š

`package.json`ã®`scripts`ã«ä»¥ä¸‹ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¿½åŠ ã—ã¾ã™ã€‚  

```json
{
  "scripts": {
    "dev": "nodemon ./index.js",
    "start": "node ./index.js"
  }
}
```

`dev`ã¯ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã€`start`ã¯é€šå¸¸ã®èµ·å‹•ã‚’è¡Œã†ãŸã‚ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã™ã€‚  
é–‹ç™ºæ™‚ã¯`dev`ã‚’ã€æœ¬ç•ªç’°å¢ƒã§ã¯`start`ã‚’å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚  

## JSã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆ

ã§ã¯ã€æ—©é€ŸGraphQLã‚µãƒ¼ãƒã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚  
`./index.js`ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¿°ã—ã¾ã™ã€‚  

```js
import { ApolloServer } from '@apollo/server';
import { startStandaloneServer } from '@apollo/server/standalone';

const typeDefs = `
  type Book {
    title: String
    author: String
  }

  type Query {
    books: [Book]
  }
`;

const books = [
  {
    title: 'The Awakening',
    author: 'Kate Chopin',
  },
  {
    title: 'City of Glass',
    author: 'Paul Auster',
  },
];

const resolvers = {
  Query: {
    books: () => books,
  },
};

const server = new ApolloServer({
  typeDefs,
  resolvers,
});

const { url } = await startStandaloneServer(server, {
  listen: { port: 4000 },
});

console.log(`ğŸš€  Server ready at: ${url}`);
```

ã‚³ãƒ¼ãƒ‰ã®ä¸­èº«ã«ã¤ã„ã¦ã¯ã€å¾Œã»ã©èª¬æ˜ã—ã¾ã™ã€‚  
ã§ã¯ã€å®Ÿéš›ã«ã‚µãƒ¼ãƒã‚’èµ·å‹•ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚  

```bash
yarn dev
```

ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã‚Œã°æˆåŠŸã§ã™ã€‚  

```bash
ğŸš€  Server ready at: http://localhost:4000/
```

ã§ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§`http://localhost:4000/`ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚  

![GraphQL sandbox](/images/graphql-server-step-by-step_sandbox.webp)  

è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‚¯ã‚¨ãƒªã‚’ãã®ã¾ã¾å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼  
æ­£ã—ããƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ãã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ï¼  

## ã‚¯ã‚¨ãƒªã«ã¤ã„ã¦

ã‚µãƒ³ãƒ—ãƒ«ã§ã¯ä»¥ä¸‹ã®ã‚¯ã‚¨ãƒªãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã¾ã™ã€‚  

```graphql
query ExampleQuery {
  books {
    title
  }
}
```

ã“ã‚Œã¯ã€`books`ã‚’å–å¾—ã™ã‚‹ã‚¯ã‚¨ãƒªã§ã™ã€‚  
ã¾ãŸã€å–å¾—å¯¾è±¡ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã—ã¦`title`ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚  
ã—ãŸãŒã£ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã£ã¦ãã¾ã™ã€‚  

```json
{
  "data": {
    "books": [
      {
        "title": "The Awakening"
      },
      {
        "title": "City of Glass"
      }
    ]
  }
}
```

ã§ã¯ã€`author`ã‚‚å–å¾—ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚  

```graphql
query ExampleQuery {
  books {
    title
    author
  }
}
```

ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã£ã¦ãã¾ã™ã€‚  

```json
{
  "data": {
    "books": [
      {
        "title": "The Awakening",
        "author": "Kate Chopin"
      },
      {
        "title": "City of Glass",
        "author": "Paul Auster"
      }
    ]
  }
}
```

æŒ‡å®šã—ãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå–å¾—ã§ãã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚  

## Queryãƒ»Mutationãƒ»Subscription

GraphQLã«ã¯ã€`Query`ãƒ»`Mutation`ãƒ»`Subscription`ã¨ã„ã†3ã¤ã®å‹ãŒã‚ã‚Šã¾ã™ã€‚  

| name | description |
| --- | --- |
| Query | ãƒ‡ãƒ¼ã‚¿ã®å–å¾— |
| Mutation | ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–° |
| Subscription | ãƒ‡ãƒ¼ã‚¿ã®è³¼èª­ |

REST APIã§ã¯ã€`GET`ãƒ»`POST`ãƒ»`PUT`ãƒ»`DELETE`ã¨ã„ã†4ã¤ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã‚Šã¾ã™ãŒã€GraphQLã§ã¯ã€`Query`ãƒ»`Mutation`ãƒ»`Subscription`ã¨ã„ã†3ã¤ã®å‹ã§ãã‚Œãã‚Œã®å½¹å‰²ã‚’æ‹…ã£ã¦ã„ã¾ã™ã€‚  

GETãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€`Query`ã«ç›¸å½“ã—ã€ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã‚’è¡Œã„ã¾ã™ã€‚  
POSTãƒ»PUTãƒ»DELETEãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€`Mutation`ã«ç›¸å½“ã—ã€ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°ã‚’è¡Œã„ã¾ã™ã€‚  
ã¾ãŸã€`Subscription`ã¯ã€ãƒ‡ãƒ¼ã‚¿ã®è³¼èª­ã‚’è¡Œã„ã¾ã™ã€‚  
ã“ã¡ã‚‰ã¯ã€å†…éƒ¨çš„ã«WebSocketã‚’ä½¿ç”¨ã—ã¦ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚  

## ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®è§£èª¬

æœ€åˆã«ã‚³ãƒ¼ãƒ‰ã§ä½¿ç”¨ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚  

å°‘ã—å‰ã¾ã§ã¯ã€`apollo-server`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã—ãŸãŒã€ç¾åœ¨ã¯`@apollo/server`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚  
2023å¹´ã®10æœˆã¾ã§ã¯`apollo-server`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚‚ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ãŒã€ä»Šå¾Œã¯`@apollo/server`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚  

ã¾ãŸã€`startStandaloneServer`ã¯`@apollo/server/standalone`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚  
ã“ã‚Œã¯ã€`ApolloServer`ã‚’ç°¡å˜ã«èµ·å‹•ã™ã‚‹ãŸã‚ã®é–¢æ•°ã§ã™ã€‚  

```js
import { ApolloServer } from '@apollo/server';
import { startStandaloneServer } from '@apollo/server/standalone';
```

æ¬¡ã«ã€GraphQLã®ã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚  
ã“ã“ã§ã¯ã€`Book`ã¨ã„ã†å‹ã¨ã€`Query`ã¨ã„ã†å‹ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚  

GraphQLã§ä½¿ç”¨ã§ãã‚‹å‹ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚  

- `Int`
- `Float`
- `String`
- `Boolean`
- `ID`

ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ãƒ‡ãƒ¼ã‚¿å‹ã¯ã€`:`ã§åŒºåˆ‡ã£ã¦ã€`Property: DataType`ã®ã‚ˆã†ã«å®šç¾©ã—ã¾ã™ã€‚  
ã¾ãŸã€é…åˆ—ã‚’å®šç¾©ã™ã‚‹å ´åˆã¯ã€`[]`ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚  

`!`ã‚’ä»˜ã‘ã‚‹ã¨ã€å¿…é ˆé …ç›®ã«ãªã‚Šã¾ã™ã€‚  

```js
const typeDefs = `
  type Book {
    title: String
    author: String
  }

  type Query {
    books: [Book]
  }
`;
```

ã“ã“ã§ã¯ã€å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚  
é€šå¸¸ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å–å¾—ã™ã‚‹ã“ã¨ã«ãªã‚‹ã¨æ€ã„ã¾ã™ãŒã€ä»Šå›ã¯ã‚µãƒ³ãƒ—ãƒ«ãªã®ã§ã€é…åˆ—ã§ãã®ã¾ã¾å®šç¾©ã—ã¦ã„ã¾ã™ã€‚  

```js
const books = [
  {
    title: 'The Awakening',
    author: 'Kate Chopin',
  },
  {
    title: 'City of Glass',
    author: 'Paul Auster',
  },
];

```

æ¬¡ã«ã€ãƒªã‚¾ãƒ«ãƒã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚  
ãƒªã‚¾ãƒ«ãƒã¨ã¯ã€ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã™ã‚‹éš›ã«å‘¼ã³å‡ºã•ã‚Œã‚‹é–¢æ•°ã®ã“ã¨ã§ã™ã€‚  
ã“ã“ã§ã¯ã€`books`ã‚’å–å¾—ã™ã‚‹ã‚¯ã‚¨ãƒªã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚  

ãƒ•ã‚£ãƒ«ã‚¿æ¡ä»¶ãªã©ã‚’æŒ‡å®šã™ã‚‹å ´åˆã«ã¯ã€å¼•æ•°ã‚’å–ã‚‹é–¢æ•°ã‚’å®šç¾©ã—ã¦ã€ãã®ä¸­ã§ãƒ•ã‚£ãƒ«ã‚¿ã‚’è¡Œã†ã‚ˆã†ã«ã—ã¾ã™ãŒã€ã“ã“ã§ã¯ãƒ•ã‚£ãƒ«ã‚¿ã‚’è¡Œã‚ãªã„ã®ã§ã€ç©ºã®å¼•æ•°ã‚’å—ã‘å–ã‚‹é–¢æ•°ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚  

```js
const resolvers = {
  Query: {
    books: () => books,
  },
};

```

ã“ã“ã§ã€ã‚µãƒ¼ãƒã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚  
å¼•æ•°ã«ã¯ãƒ‡ãƒ¼ã‚¿å‹ã‚’å®šç¾©ã—ãŸ`typeDefs`ã¨ã€ãƒªã‚¾ãƒ«ãƒã‚’å®šç¾©ã—ãŸ`resolvers`ã‚’æŒ‡å®šã—ã¾ã™ã€‚  

```js
const server = new ApolloServer({
  typeDefs,
  resolvers,
});

```

æœ€å¾Œã«ã€ã‚µãƒ¼ãƒã‚’èµ·å‹•ã—ã¦ã„ã¾ã™ã€‚  
  
```js
const { url } = await startStandaloneServer(server, {
  listen: { port: 4000 },
});

console.log(`ğŸš€  Server ready at: ${url}`);
```
