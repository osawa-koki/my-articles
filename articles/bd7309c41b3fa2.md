---
title: "Azure Functionsã§å…¥åŠ›å€¤ã®æ¤œè¨¼ã‚’è¡Œã†"
emoji: "ğŸ™Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Azure", "Azure Functions", "ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯"]
published: true
---

## Azure Functionsã§å…¥åŠ›å€¤ã®æ¤œè¨¼ã‚’è¡Œã†

æ‰‹é †ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚  

1. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ç”¨ã®ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã™ã‚‹
2. Validatorã‚¯ãƒ©ã‚¹ã«ã‚ˆã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†

### 1. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ç”¨ã®ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã™ã‚‹

é€šå¸¸ã®ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã€æ¤œè¨¼å†…å®¹ã‚’è¨˜è¿°ã—ã¾ã™ã€‚  

- `[Required]`å±æ€§ã‚’ä»˜ä¸ã™ã‚‹ã“ã¨ã§ã€å¿…é ˆé …ç›®ã¨ã—ã¦æ‰±ã†ã“ã¨ãŒã§ãã¾ã™ã€‚  
- `[Range]`å±æ€§ã‚’ä»˜ä¸ã™ã‚‹ã“ã¨ã§ã€ç¯„å›²ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚  
- `[RegularExpression]`å±æ€§ã‚’ä»˜ä¸ã™ã‚‹ã“ã¨ã§ã€æ­£è¦è¡¨ç¾ã§ã®æ¤œè¨¼ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚  

```cs
public class User
{
  [JsonProperty("name")]
  [Required(ErrorMessage = "The name field is required.")]
  public string Name { get; set; }

  [JsonProperty("profession")]
  [Required(ErrorMessage = "The profession field is required.")]
  public string Profession { get; set; }

  [JsonProperty("age")]
  [Required(ErrorMessage = "The age field is required.")]
  [Range(1, int.MaxValue, ErrorMessage = "The age must be a positive integer.")]
  public int Age { get; set; }
}
```

### 2. Validatorã‚¯ãƒ©ã‚¹ã«ã‚ˆã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†

æœ€åˆã«ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã€`Validate`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚  

```cs
// ã‚¯ãƒ©ã‚¹ã®ç”Ÿæˆ
var user = JsonConvert.DeserializeObject<User>("{...}");

var validationContext = new ValidationContext(user, serviceProvider: null, items: null);
var validationResults = new List<ValidationResult>();
bool isValid = Validator.TryValidateObject(user, validationContext, validationResults, true);
if (isValid == false)
{
  // æ¤œè¨¼ã«å¤±æ•—ã—ãŸå ´åˆã®å‡¦ç†
  return new BadRequestObjectResult(validationResults);
}

// æ¤œè¨¼ã«æˆåŠŸã—ãŸå ´åˆã®å‡¦ç†
```

## åˆ©ç‚¹

- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ã®è¨˜è¿°ãŒã‚·ãƒ³ãƒ—ãƒ«ã«ãªã‚‹
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ã®è¨˜è¿°ãŒã‚¯ãƒ©ã‚¹ã«é›†ç´„ã•ã‚Œã‚‹
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ã®è¨˜è¿°ãŒå…±é€šåŒ–ã§ãã‚‹
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ã®è¨˜è¿°ãŒãƒ†ã‚¹ãƒˆå¯èƒ½ã«ãªã‚‹
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ã®è¨˜è¿°ãŒæ‹¡å¼µå¯èƒ½ã«ãªã‚‹

## æ³¨æ„ç‚¹

æ§‹é€ ä½“(Struct)ã¯ã€`Validator.TryValidateObject`ãƒ¡ã‚½ãƒƒãƒ‰ã§æ¤œè¨¼ã§ãã¾ã›ã‚“ã€‚  
`System.Private.CoreLib: Exception while executing function: Insert. System.ComponentModel.Annotations: The instance provided must match the ObjectInstance on the ValidationContext supplied. (Parameter 'instance').`ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚  
