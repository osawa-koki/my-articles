---
title: "Amplify Gen2を用いて簡単なWebアプリを実装してみる！"
emoji: "🐕"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["AWS", "Amplify"]
published: true
---

# Amplify

Amplify とは、モバイルアプリケーション・ウェブアプリケーション・静的ウェブアプリケーションを構築するための、AWS のフルスタックアプリケーション開発フレームワークです。  
バックエンドのリソースをプロビジョニングし、フロントエンドのコードを生成し、デプロイするためのツールを提供します。  

Amplify を用いない場合、CloudFormation や Terraform を用いて AWS のリソースを構築し、その上にアプリケーションを構築します。 　
Amplify は内部的にこれらのリソースを管理するため、開発者はリソースの管理に集中することなく、アプリケーションの開発に集中できます。  

一般的なアプリケーションは以下の要素から構成されます。  

- ユーザー認証
- ファイルストレージ
- データベース
- API
- ウェブホスティング
- デプロイ

Amplify では、内部的に AWS のリソースを生成することで、これらの要素を簡単に構築できます。  
具体的には、それぞれ以下のようなリソースを生成します。  

- ユーザー認証: Cognito
- ファイルストレージ: S3
- データベース: DynamoDB
- API: API Gateway + Lambda or AppSync
- ウェブホスティング: S3 or CloudFront
- デプロイ: CodePipeline

Cognito では、ユーザー認証の他にも、ユーザーの属性を管理できます。  
メールアドレスの確認や、パスワードリセットなども簡単に実装できます。  

S3 では、ファイルのアップロードやダウンロード、ファイルの公開などが簡単に実装できます。  
自分のみがアクセスできるファイルや、一般公開されたファイルなど、様々な設定が可能です。  

DynamoDB では、NoSQL データベースを簡単に構築できます。  
スケーラビリティや可用性を考慮する必要がなく、簡単にデータベースを構築できます。  
自分のみがアクセスできるデータや、一般公開されたデータなど、様々な設定が可能です。  

API Gateway + Lambda では、RESTful API を簡単に構築できます。  
また、AppSync を用いることで、GraphQL API が実現できます。  

S3 や CloudFront を用いることで、ウェブホスティングを簡単に実装できます。  

CodePipeline を用いることで、デプロイを自動化できます。  
GitHub の特定のブランチへのプッシュをトリガーとして、自動的にデプロイが行われるように設定できます。  

## Amplify Gen2

Amplify Gen2 は、Amplify の新しいバージョンです。  
以下の特徴があります。

| 特徴 | Amplify Gen1 | Amplify Gen2 |
| --- | --- | --- |
| 環境の管理 | `amplify env add`で環境を追加。<br />`amplify env checkout`で環境を切り替え。<br />環境に関する情報は Git管理対象の`amplify/team-provider-info.json` に保存。 | サンドボックスの概念が導入。<br />`npx ampx sandbox`でサンドボックスを起動。<br />環境に関する情報は Git管理対象外の`amplify_outputs.json` に保存。<br />本番環境とサンドボックス環境の分離が明確化。 |
| デプロイ方法 | `amplify push`でデプロイ。<br />`amplify publish`でウェブホスティングのデプロイ。 | Gitベース(`git push`)でのデプロイ。 |
| GraphQLスキーマやAPI設定 | `amplify/backend/api/<Amplifyのプロジェクト名>/schema.graphql`ファイルに記述。 | `amplify/data/resource.ts`ファイルにデータベースのスキーマやAPIの設定を定義。 |

サンドボックス概念が導入されたことで、本番環境とサンドボックス環境の分離が明確化されました。  
各開発者が独自の環境を持ち、開発することが可能になりました。  
これにより、開発者同士の干渉を防ぎ、かつ環境依存のない開発効率を向上させることができます。  
当然、本番環境とサンドボックス環境のデータは分離されているため、本番環境に影響を与えることはありません。  

## 参考文献

- [Amplify | Next.js App Router](https://docs.amplify.aws/nextjs/start/quickstart/nextjs-app-router-client-components/)
- [AWS Amplify を開始する](https://aws.amazon.com/jp/amplify/getting-started/)
- [Gen 2 for Gen 1 customers](https://docs.amplify.aws/nextjs/start/migrate-to-gen2/)
