---
title: "AWS SAM"
emoji: "ğŸ’¬"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["AWS", "AWS SAM", "IaC", "CloudFormation", "Serverless"]
published: true
---

## AWS SAM

> AWS SAM ã¯ã€Serverless Application Model ã®ç•¥ç§°ã§ã€AWS ä¸Šã§ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã‚‹ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ã“ã¨ã§ã™ã€‚  
> å˜ç´”ãª YAML ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ (Lambda é–¢æ•°ã€API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€DynamoDB ãƒ†ãƒ¼ãƒ–ãƒ«ã€ãŠã‚ˆã³ãã®ä»–ã®ãƒªã‚½ãƒ¼ã‚¹) ã‚’è¨˜è¿°ã™ã‚‹ãŸã‚ã®ç•¥å¼æ§‹æ–‡ã‚’æä¾›ã—ã¾ã™ã€‚  
> ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆä¸­ã€SAM ã¯çŸ­ç¸®å½¢ SAM æ§‹æ–‡ã‚’ AWS CloudFormation ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«å¤‰æ›ã—ã¦å±•é–‹ã—ã¾ã™ã€‚  
> ãã®å¾Œã€CloudFormation ã¯ä¿¡é ¼æ€§ã¨å†ç¾æ€§ã®é«˜ã„æ–¹æ³•ã§ãƒªã‚½ãƒ¼ã‚¹ã‚’ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã—ã¾ã™ã€‚  
> â€»[å…¬å¼ã‚µã‚¤ãƒˆ](https://aws.amazon.com/jp/blogs/news/aws-serverless-application-model-sam-command-line-interface-build-test-and-debug-serverless-apps-locally/)ã‚ˆã‚Šå¼•ç”¨ã€‚  

## æ¦‚è¦

æœ€åˆã«`CloudFormation`ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚  
`CloudFormation`ã¯ã€AWSä¸Šã§ãƒªã‚½ãƒ¼ã‚¹ã‚’ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã™ã‚‹ãŸã‚ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚  
IaC(Infrastructure as Code)ã®ä¸€ã¤ã§ã€AWSä¸Šã§ãƒªã‚½ãƒ¼ã‚¹ã‚’ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã™ã‚‹ãŸã‚ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆã—ã€ãã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å…ƒã«ãƒªã‚½ãƒ¼ã‚¹ã‚’ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã—ã¾ã™ã€‚  

## IaCã®åˆ©ç‚¹

ã“ã®åˆ©ç‚¹ã¨ã—ã¦ã¯ã€Webä¸Šã§GUIã§ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ã‚ˆã‚Šã‚‚ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ã€ãƒªã‚½ãƒ¼ã‚¹ã®ç®¡ç†ãŒã—ã‚„ã™ããªã‚Šã¾ã™ã€‚  
å…·ä½“çš„ã«ã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã‚„ã€æ“ä½œãƒŸã‚¹ã€ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚„ã€è„†å¼±æ€§ã®ãƒã‚§ãƒƒã‚¯ãªã©ãŒã§ãã¾ã™ã€‚  

## ã‚‚ã†ä¸€åº¦ã€AWS SAMã«ã¤ã„ã¦

AWS SAMã¯ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«`CloudFormation`ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«å¤‰æ›ã—ã¦å±•é–‹ã•ã‚Œã‚‹ã“ã¨ã‹ã‚‰ã€ã‚µãƒ¼ãƒãƒ¬ã‚¹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å°‚ç”¨ã®IaCãƒ„ãƒ¼ãƒ«ã¨ãªã‚Šã¾ã™ã€‚  
AWSã§ã¯ã€Lambdaã‚„API Gatewayãªã©ã®ã‚µãƒ¼ãƒãƒ¬ã‚¹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚  

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

æœ€åˆã«ã€AWS CLIã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚  
[å…¬å¼ã‚µã‚¤ãƒˆ](https://docs.aws.amazon.com/ja_jp/cli/latest/userguide/install-cliv2.html)ã‚ˆã‚Šã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚  

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒæ­£ã—ãã§ãã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚  

```shell
aws --version
```

æ¬¡ã«ã€AWS SAMã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚  
[å…¬å¼ã‚µã‚¤ãƒˆ](https://docs.aws.amazon.com/ja_jp/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html)ã‚ˆã‚Šã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚  

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒæ­£ã—ãã§ãã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚  

```shell
sam --version
```

æœ€å¾Œã«ã€Dockerã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚  
[å…¬å¼ã‚µã‚¤ãƒˆ](https://docs.docker.com/get-docker/)ã‚ˆã‚Šã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚  

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚  

```shell
sam init
```

å¯¾è©±å‹ã§è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚  
å„è‡ªã®ç’°å¢ƒã«åˆã‚ã›ã¦è¨­å®šã—ã¦ãã ã•ã„ã€‚  

ã“ã“ã§ã¯ã€ã‚‚ã£ã¨ã‚‚ä¸€èˆ¬çš„ãªPythonã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚  

```shell
You can preselect a particular runtime or package type when using the `sam init` experience.
Call `sam init --help` to learn more.

Which template source would you like to use?
        1 - AWS Quick Start Templates
        2 - Custom Template Location
Choice: 1

Choose an AWS Quick Start application template
        1 - Hello World Example
        2 - Multi-step workflow
        3 - Serverless API
        4 - Scheduled task
        5 - Standalone function
        6 - Data processing
        7 - Infrastructure event management
        8 - Serverless Connector Hello World Example
        9 - Multi-step workflow with Connectors
        10 - Lambda EFS example
        11 - Machine Learning
Template: 1

Use the most popular runtime and package type? (Python and zip) [y/N]: y

Would you like to enable X-Ray tracing on the function(s) in your application?  [y/N]: N

Would you like to enable monitoring using CloudWatch Application Insights?
For more info, please view https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/cloudwatch-application-insights.html [y/N]: N

Project name [sam-app]: ğŸ™ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåğŸ™

Cloning from https://github.com/aws/aws-sam-cli-app-templates (process may take a moment)

    -----------------------
    Generating application:
    -----------------------
    Name: ğŸ™ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåğŸ™
    Runtime: python3.9
    Architectures: x86_64
    Dependency Manager: pip
    Application Template: hello-world
    Output Directory: .

    Next steps can be found in the README file at ./ğŸ™ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåğŸ™-lambda/README.md


Commands you can use next
=========================
[*] Create pipeline: cd ğŸ™ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåğŸ™-lambda && sam pipeline init --bootstrap
[*] Validate SAM template: cd ğŸ™ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåğŸ™-lambda && sam validate
[*] Test Function in the Cloud: cd ğŸ™ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåğŸ™-lambda && sam sync --stack-name {stack-name} --watch
```

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å®Ÿè¡Œ

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚  
ã“ã‚Œã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚  

```shell
sam build --use-container
sam local start-api
```

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚  

```shell
sam build --use-container
sam deploy {--guided}
```

`--guided`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã‚‹ã¨ã€å¯¾è©±å‹ã§è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚  
å„è‡ªã®ç’°å¢ƒã«åˆã‚ã›ã¦è¨­å®šã—ã¦ãã ã•ã„ã€‚  

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å‰Šé™¤

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã€‚  

```shell
sam delete
```
